// Cluster configuration for genomic analysis pipeline

params {
    outdir = "/data/users/$USER/nextflow-training/results_cluster"
}

profiles {
    slurm {
        process {
            executor = 'slurm'

            // Default resources
            cpus = 2
            memory = '4 GB'
            time = '2h'

            // Process-specific resources for intensive tasks
            withName: spades_assembly {
                cpus = 8
                memory = '16 GB'
                time = '6h'
            }

            withName: prokka_annotation {
                cpus = 4
                memory = '8 GB'
                time = '3h'
            }

            withName: trimmomatic {
                cpus = 4
                memory = '8 GB'
                time = '2h'
            }
        }

        executor {
            queueSize = 20
            submitRateLimit = '10 sec'
        }
    }

    // High-memory profile for large genomes
    highmem {
        process {
            executor = 'slurm'

            withName: spades_assembly {
                cpus = 16
                memory = '64 GB'
                time = '12h'
            }

            withName: prokka_annotation {
                cpus = 8
                memory = '16 GB'
                time = '6h'
            }
        }
    }
}

// Enhanced reporting for cluster runs
trace {
    enabled = true
    file = "${params.outdir}/pipeline_trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes'
}

timeline {
    enabled = true
    file = "${params.outdir}/pipeline_timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_report.html"
}
